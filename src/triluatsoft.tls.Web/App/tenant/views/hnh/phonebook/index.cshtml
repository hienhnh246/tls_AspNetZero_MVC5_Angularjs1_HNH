@using triluatsoft.tls.Authorization

<div ng-controller="tenant.views.hnh.phonebook.index as vm">
    <div class="row margin-bottom-5">
        <div class="col-xs-6">
            <div class="page-head">
                <div class="page-title">
                    <h1>
                        <span>@L("PhoneBook")</span> <small>@L("PhoneBookHeaderInfo")</small>
                    </h1>
                </div>
            </div>
        </div>
        <div class="col-xs-6 text-right">
            @if (IsGranted(AppPermissions.Pages_Tenant_PhoneBook_CreatePerson))
            {
                <button ng-if="vm.permissions.createPerson" class="btn btn-primary blue" ng-click="vm.openCreatePersonModal()"><i class="fa fa-plus"></i> @L("CreateNewPerson")</button>
            }
        </div>
    </div>
    <div class="portlet light margin-bottom-0">
        <div class="portlet-body">
            <h3>@L("AllPeople") ({{vm.personPage.totalPerson}})</h3>

            <div class="form">
                <form class="horizontal-form">
                    <div class="form-body" enter-key="vm.getPeoplePagination()">
                        <div class="row margin-bottom-10">
                            <div class="col-md-12">
                                <div class="inputs inputs-full-width">
                                    <div class="portlet-input">
                                        <div class="input-group">
                                            <input ng-model="vm.filterText" auto-focus class="form-control" placeholder="@L("SearchWithThreeDot")" type="text">
                                            <span class="input-group-btn">
                                                <button ng-click="vm.getPeoplePagination()" class="btn default" type="submit"><i class="icon-magnifier"></i></button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div ng-if="vm.personPage.totalPerson==0" class="text-muted">
                @L("NoPeopleInListYet")
            </div>

            @*<div id="AllPeopleList" class="list-group">
                <a href="javascript:;" class="list-group-item" ng-repeat="person in vm.persons">
                    <h4 class="list-group-item-heading">
                        {{person.name}} {{person.surname}}
                        <button ng-if="vm.permissions.deletePerson" ng-click="vm.deletePerson(person)" title="@L("Delete")" class="btn btn-circle btn-icon-only red delete-person" href="javascript:;">
                            <i class="icon-trash"></i>
                        </button>
                    </h4>
                    <p class="list-group-item-text">
                        {{person.emailAddress}}
                    </p>
                </a>
            </div>*@

            <div busy-if="vm.loading" id="AllPeopleList" class="list-group">
                <div class="list-group-item" ng-repeat="person in vm.persons" ng-class="{'phone-editing':person==vm.editingPhone}">
                    <h4 class="list-group-item-heading">
                        {{person.name}} {{person.surname}}
                        <span class="person-buttons">
                            <button ng-click="vm.phoneDetail(person)" title="@L("PhoneNumber")" class="btn btn-circle btn-icon-only green">
                                <i class="fa fa-address-book-o" aria-hidden="true"></i>
                            </button>

                            @if (IsGranted(AppPermissions.Pages_Tenant_PhoneBook_EditPerson))
                            {
                                <button ng-if="vm.permissions.editPerson" ng-click="vm.openEditPersonModal(person.id)" title="@L("Edit")" class="btn btn-circle btn-icon-only yellow">
                                    <i class="icon-pencil"></i>
                                </button>
                            }
                            @if (IsGranted(AppPermissions.Pages_Tenant_PhoneBook_DeletePerson))
                            {
                                <button ng-if="vm.permissions.deletePerson" ng-click="vm.deletePerson(person)" title="@L("Delete")" class="btn btn-circle btn-icon-only red">
                                    <i class="icon-trash"></i>
                                </button>
                            }
                        </span>
                    </h4>
                    <p class="list-group-item-text">
                        {{person.emailAddress}} - @L("TotalPhones"): {{person.phones.length}}
                    </p>
                    <div class="table-scrollable" ng-if="person==vm.editingPhone">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th style="width:10%"></th>
                                    <th style="width:30%">@L("Type")</th>
                                    <th style="width:60%">@L("PhoneNumber")</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="phone in person.phones">
                                    <td style="text-align:center">
                                        @*<button ng-click="vm.deletePhone(phone, person)" class="btn btn-sm btn-default">
                                        <i class="icon-trash"></i>
                                    </button>*@
                                        {{$index+1}}
                                    </td>
                                    <td>{{vm.getPhoneTypeAsString(phone.type)}}</td>
                                    <td>{{phone.number}}</td>
                                </tr>
                                <tr>
                                    <td>
                                        <button ng-click="vm.addPhone(person.newPhone, person)" class="btn btn-sm green">
                                            <i class="fa fa-floppy-o"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <select name="Type" class="form-control" ng-model="person.newPhone.type">
                                            <option value="">@L("PleaseSelect")</option>
                                            <option value="0">@L("PhoneType_Mobile")</option>
                                            <option value="1">@L("PhoneType_Home")</option>
                                            <option value="2">@L("PhoneType_Business")</option>
                                        </select>
                                    </td>
                                    <td><input type="number" name="Number" class="form-control" ng-model="person.newPhone.number" /></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div ng-if="vm.personPage.totalPerson>vm.personPage.maxResultCount" class="row margin-top-10" style="text-align:center">
                    <span>
                        <button ng-class="vm.personPage.personPageNum == 1 ? 'button-visibility':''" ng-click="vm.backPersonPage()" class="btn btn-default" type="button"><< @L("Previous")</button>
                        <span style="margin-left:20px; margin-right:20px">{{vm.personPage.personPageNum}} / {{vm.personPage.totalPersonPage}}</span>
                        <button ng-class="vm.personPage.personPageNum == vm.personPage.totalPersonPage? 'button-visibility':''" ng-click="vm.nextPersonPage()" class="btn btn-default" type="button">@L("Next") >></button>
                    </span>
                </div>

            </div>

        </div>
    </div>
</div>